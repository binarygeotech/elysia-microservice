<div align="center">

# Elysia Microservice Framework

<p>
  <strong>A modular, transport-agnostic microservices framework for <a href="https://elysiajs.com/">Elysia</a></strong>
</p>

<p>
  <a href="https://www.npmjs.com/package/@elysia-microservice/core"><img src="https://img.shields.io/npm/v/@elysia-microservice/core.svg" alt="npm version"></a>
  <a href="https://github.com/yourusername/elysia-microservice/blob/main/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License"></a>
  <a href="https://github.com/yourusername/elysia-microservice/stargazers"><img src="https://img.shields.io/github/stars/yourusername/elysia-microservice.svg" alt="GitHub stars"></a>
  <a href="CODE_OF_CONDUCT.md"><img src="https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg" alt="Contributor Covenant"></a>
</p>

<p>
  <strong>Build production-ready microservices with Elysia's speed and simplicity</strong>
</p>

</div>

---

## âœ¨ Features

- ğŸ”Œ **Plugin Mode** - Seamless integration with Elysia (HTTP + Microservice)
- âš¡ **Standalone Mode** - Pure microservice applications without HTTP
- ğŸ¯ **Advanced Pattern Matching** - Wildcards (`user.*`), regex, and catchall handlers
- ğŸ”€ **Transport Agnostic** - Support for TCP, TLS, NATS, Redis, and Kafka
- ğŸ“¦ **Modular** - Install only what you need, tree-shakable bundles
- ğŸ”„ **Service Discovery** - Static and DNS-based service discovery
- âš–ï¸ **Load Balancing** - Round-robin with failure tracking
- ğŸ›¡ï¸ **Resilience** - Circuit breaker, retries, and timeouts
- ğŸ­ **Chaos Engineering** - Inject failures and latency for testing
- ğŸ”— **NestJS Compatible** - Use NestJS decorators with Elysia
- ğŸ“Š **Connection Pooling** - Automatic client pooling with failover
- ğŸª **Lifecycle Hooks** - onBefore/onAfter hooks for cross-cutting concerns
- ğŸ¥ **Health Checks** - Built-in health and readiness endpoints (hybrid mode)
- ğŸ“ **TypeScript First** - Full type safety with excellent IntelliSense

## ğŸ“š Documentation

- **[Getting Started](docs/guides/getting-started.md)** - Quick start guide for new users
- **[Pattern Matching](docs/guides/PATTERN_MATCHING.md)** - Wildcards, regex, and catchall handlers
- **[Advanced Features](docs/guides/advanced-features.md)** - Hooks, error handling, resilience patterns
- **[API Reference](docs/api/core.md)** - Complete API documentation
- **[Architecture](docs/ARCHITECTURE.md)** - System design and architecture
- **[Migration Guide](docs/MIGRATION.md)** - Upgrading from previous versions
- **[Contributing](CONTRIBUTING.md)** - How to contribute to this project
- **[Code of Conduct](CODE_OF_CONDUCT.md)** - Community guidelines
- **[Changelog](docs/CHANGELOG.md)** - Version history and updates

## ğŸ“¦ Packages

This monorepo contains the following packages:

### Core
- **[@elysia-microservice/core](./packages/core)** - Core functionality (registry, protocol, patterns, context)

### Utilities
- **[@elysia-microservice/utils](./packages/utils)** - Service discovery, load balancing, client pooling, chaos engineering

### Transport Servers
- **[@elysia-microservice/transport-tcp](./packages/transport-tcp)** - TCP transport server
- **[@elysia-microservice/transport-tls](./packages/transport-tls)** - TLS/SSL transport server
- **[@elysia-microservice/transport-nats](./packages/transport-nats)** - NATS transport server
- **[@elysia-microservice/transport-redis](./packages/transport-redis)** - Redis transport server
- **[@elysia-microservice/transport-kafka](./packages/transport-kafka)** - Kafka transport server

### Clients
- **[@elysia-microservice/client-tcp](./packages/client-tcp)** - TCP client
- **[@elysia-microservice/client-tls](./packages/client-tls)** - TLS/SSL client
- **[@elysia-microservice/client-nats](./packages/client-nats)** - NATS client
- **[@elysia-microservice/client-redis](./packages/client-redis)** - Redis client
- **[@elysia-microservice/client-kafka](./packages/client-kafka)** - Kafka client
- **[@elysia-microservice/client-base](./packages/client-base)** - Client factory, proxy, and resilience

### Adapters

- **[@elysia-microservice/adapters](./packages/adapters)** - Framework adapters (NestJS compatibility)

---

### Installation

Install only the packages you need:

```bash
# Core with plugin (required)
bun add @elysia-microservice/core elysia

# TCP transport (server + client)
bun add @elysia-microservice/transport-tcp @elysia-microservice/client-tcp

# Or use any other transport
bun add @elysia-microservice/transport-nats @elysia-microservice/client-nats nats
```

### Plugin Mode (Hybrid: HTTP + Microservice)

Perfect for applications that need both REST APIs and microservice communication.

```typescript
import { Elysia } from 'elysia';
import { Microservice } from '@elysia-microservice/core';

const app = new Elysia()
  .use(Microservice({ 
    server: { transport: 'tcp', options: { port: 4000 } },
    hybrid: true  // Enable HTTP health endpoints
  }))
  // Microservice handlers
  .onMsMessage('get.user', async ({ data }) => {
    return { id: data.id, name: 'John Doe' };
  })
  .onMsEvent('user.created', ({ data }) => {
    console.log('User created:', data);
  })
  // Pattern matching with wildcards
  .onMsMessage('users.*', ({ pattern, data }) => {
    // Handles users.created, users.updated, users.deleted, etc.
    return { operation: pattern, success: true };
  })
  // Catchall handler for unmatched patterns
  .onMsCatchallMessage((pattern, data) => {
    console.warn(`No handler for: ${pattern}`);
    return { error: 'Pattern not found' };
  })
  // Regular HTTP routes
  .get('/', () => 'Hello HTTP!')
  .listen(3000);

console.log('ğŸš€ HTTP server on http://localhost:3000');
console.log('ğŸ”Œ Microservice on tcp://localhost:4000');
```

### Standalone Mode (Microservice Only)

Perfect for pure microservice applications without HTTP server.

```typescript
import { Elysia } from 'elysia';
import { Microservice } from '@elysia-microservice/core';

const app = new Elysia()
  .use(Microservice({ 
    server: { transport: 'tcp', options: { port: 4000 } }
  }))
  .onMsMessage('get.user', async (data) => {
    return { id: data.id, name: 'John Doe' };
  })
  .onMsEvent('user.created', (data) => {
    console.log('User created:', data);
  });

// Start the microservice manually
await app.microservice.start();
await app.microservice.awaitReady();

console.log('ğŸ”Œ Microservice running on tcp://localhost:4000');
```

### Basic Usage (Low-Level API)

For more control, use the low-level API directly.

#### Server

```typescript
import { createRegistry } from '@elysia-microservice/core';
import { createTcpTransport } from '@elysia-microservice/transport-tcp';

const registry = createRegistry();

registry.registerMessage('get.user', async (data) => {
  return { id: data.id, name: 'John Doe' };
});

const server = createTcpTransport(registry, { port: 4000 });
```

#### Client

```typescript
import { createTcpClient } from '@elysia-microservice/client-tcp';

const client = createTcpClient({ port: 4000, host: '127.0.0.1' });

const user = await client.send('get.user', { id: 1 });
console.log(user); // { id: 1, name: 'John Doe' }

await client.emit('user.created', { id: 1, name: 'John' });
```

### With Client Factory

```typescript
import { createClient } from '@elysia-microservice/client-base';

const client = await createClient({
  transport: 'tcp',
  options: { host: '127.0.0.1', port: 4000 }
});

const user = await client.send('get.user', { id: 1 });
```

### With Resilience

```typescript
import { createClient, withResilience } from '@elysia-microservice/client-base';

let client = await createClient({ transport: 'tcp', options: { port: 4000 } });

client = withResilience(client, {
  retries: 3,
  timeout: 5000,
  breakerThreshold: 5
});
```

## ğŸ—ï¸ Development

### Build All Packages

```bash
bun install
bun run build
```

### Build Individual Package

```bash
cd packages/core
bun run build
```

### Testing

```bash
# Run unit tests (fast, no external dependencies)
bun run test:unit

# Run integration tests (requires published packages)
bun run test:integration

# Run all tests
bun test
```

See [TEST_REORGANIZATION.md](./TEST_REORGANIZATION.md) for details on the two-tier test structure.

### Clean Build Artifacts

```bash
bun run clean
```

## ğŸ“š Features

- **ğŸ”Œ Plugin Mode**: Seamless integration with Elysia (HTTP + Microservice)
- **âš¡ Standalone Mode**: Pure microservice applications
- **ğŸ¯ Pattern Matching**: Wildcards, regex patterns, and catchall handlers
- **ğŸ”€ Transport Agnostic**: Support for TCP, TLS, NATS, Redis, and Kafka
- **ğŸ“¦ Modular**: Install only what you need
- **ğŸ”„ Service Discovery**: Static and DNS-based service discovery
- **âš–ï¸ Load Balancing**: Round-robin with failure tracking
- **ğŸ›¡ï¸ Resilience**: Circuit breaker, retries, and timeouts
- **ğŸ­ Chaos Engineering**: Inject failures and latency for testing
- **ğŸ”— NestJS Compatible**: Use NestJS decorators with Elysia
- **ğŸ“Š Connection Pooling**: Automatic client pooling with failover
- **ğŸŒ³ Tree-shakable**: Optimized bundle size
- **ğŸ¥ Health Checks**: Built-in health and readiness endpoints (hybrid mode)

## ğŸ“– Documentation

Each package has its own README with detailed usage examples:

- [Core Documentation](./packages/core/README.md)
- [Pattern Matching Guide](./PATTERN_MATCHING.md) - **NEW!** Wildcards, regex, and catchall handlers
- [Utils Documentation](./packages/utils/README.md)
- [Transport Documentation](./packages/transport-tcp/README.md)
- [Client Documentation](./packages/client-tcp/README.md)
- [Client Base Documentation](./packages/client-base/README.md)
- [Adapters Documentation](./packages/adapters/README.md)

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## ğŸ“„ License

MIT License - see individual package LICENSE files for details.

## ğŸ”— Links

- [Elysia](https://elysiajs.com/)
- [Bun](https://bun.sh/)
